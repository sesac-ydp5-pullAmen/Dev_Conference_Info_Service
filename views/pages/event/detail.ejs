<!DOCTYPE html>
<html lang="ko">
<head>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
        crossorigin="anonymous" />
        
        
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=6f19fc94da41af704131c0bd9ae48f87&libraries=services"></script>

    <%- include('../../common/head.ejs', {title: '행사 상세' }) %>
</head>

<body>
    <header><%- include('../../common/header.ejs') %></header>

    <main class="container mt-5">
        <section class="row">
            <!-- 왼쪽 컨텐츠 - 행사 이미지 -->
            <div class="col-md-4">
                <!-- 행사 이미지 추가 -->
                <img src="<%=conference.con_image%>" alt="행사 이미지" class="img-fluid mb-4" />
            </div>

            <!-- 오른쪽 컨텐츠 - 행사 타이틀 및 날짜 정보 -->
            <div class="col-md-8">
                <!-- 행사 정보 --> 
                <button class="btn btn-primary mb-3" onclick="location.href='/review/write'">이 행사에 대한 리뷰 남기기</button>
                <button class="btn btn-success mb-3" onclick="saveConference()">이 행사 저장하기(찜하기로 변경할거임)</button>
                <h1 class="display-4"><%-conference.con_title%></h1>
                <p class="mb-2">이 행사에 <%- confavorite %>명이 관심이 있습니다.</p>
                <p class="mb-2">행사 시작 날짜: <%- conference.con_start_date %></p>
                <p class="mb-2">행사 종료 날짜: <%- conference.con_end_date %></p>
                <p class="mb-2">행사 분야: <%- conference.con_category %></p>
                <p class="mb-2">행사 주최: <%- conference.con_company %></p>
               
                
            </div>
        </section>

        <!-- 행사 상세 내용 -->
        <section class="row" id="conference-detail-info">
            <div class="col-md-12">
                <p class="mb-2">행사 모집 시작 날짜: <%- conference.sub_start_date %></p>
                <p class="mb-2">행사 모집 종료 날짜: <%- conference.sub_end_date %></p>
                <p class="mb-2">행사 URL: <a href="<%= conference.con_company_url %>"><%- conference.con_company_url %></a></p>
                <p class="mb-2">참가 비용: <%- conference.con_isfree ? '무료' : '유료' %></p>
                <p class="lead">온라인/오프라인: <%- conference.is_onoff ? '오프라인' : '온라인' %></p>
                
                <% if (conference.is_onoff) { %>
                    <p class="lead">도로명주소: <%- conference.con_detail_location.addr %></p>
                    <p class="lead">우편 주소: <%- conference.con_detail_location.postCode %></p>
                    <p class="lead">상세 주소: <%- conference.con_detail_location.extraAddr%></p>
        
                    <!-- 지도 그릴 거임 -->
                    <div id="map" style="width: 100%; height: 400px;"></div>
        
                    <!-- 아래 스크립트를 추가 -->
                    
                <%}%>
                    
                <h2 class="mt-4">행사 상세 내용</h2>
                <p><%- conference.con_detail %></p>

            </div>
        </section>
        <!-- 행사 리뷰 -->
        <section class="row" id="conference-review">
            <div class="col-md-12">
                <h2 class="mt-4">행사 리뷰</h2>
                <% if (reviews && reviews.length > 0) { %>
                    <% reviews.forEach(function(review) { %>
                        <p class="lead">행사 리뷰 제목: <%- review.re_title %></p>
                        <p class="lead">행사 리뷰 작성자: <%- review.user_id %></p>
                    <% }); %>
                <% } else { %>
                    <p class="lead">리뷰가 없습니다.</p>
                <% } %>
            </div>
        </section>
    </main>

    <footer>
        <!-- Footer 내용 추가 -->
    </footer>

    <!-- Bootstrap 스크립트 추가 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <!-- Axios 라이브러리 및 saveConference 함수 추가 -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        async function saveConference(con_id) {
            try {
                var currentPageURL = window.location.href;

                // URL에서 숫자 추출
                var match = currentPageURL.match(/\/(\d+)$/);
                if (match) {
                    var number1 = match[1];

                    console.log(number1);

                    // axios를 사용하여 POST 요청 보내기
                    const response = await axios.post(`/event/${number1}`, {
                        con_id: number1,
                    });

                    console.log(response.data.result);
                    if (response.data.result === 1) {
                        alert('로그인 후 찜 기능을 이용하실 수 있습니다.');
                    } else if (response.data.result === 2) {
                        alert(
                            '이미 찜한 행사입니다! 찜한 행사는 마이페이지에서 확인할 수 있습니다.'
                        );
                    } else {
                        alert(
                            '찜 성공! 찜한 행사는 마이페이지에서 확인할 수 있습니다.'
                        );
                    }
                } else {
                    console.error('URL에서 숫자를 찾을 수 없습니다.');
                }
            } catch (error) {
                // 예외 처리 코드
                console.error('에러 발생:', error);
            }
        }
//         //지도
//         var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
// var options = { //지도를 생성할 때 필요한 기본 옵션
// 	center: new kakao.maps.LatLng(33.450701, 126.570667), //지도의 중심좌표.
// 	level: 3 //지도의 레벨(확대, 축소 정도)
// };

// var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴
    </script>
    <script>
        
        window.onload = function () {
            // Kakao 지도 API 초기화
            kakao.maps.load(function () {
                var container = document.getElementById('map'); // 지도를 담을 영역의 DOM 레퍼런스
                var postCode = '<%- conference.con_detail_location.addr %>'; // 페이지에서 받아온 우편번호 사용
    
                // Geocoder 초기화
                var geocoder = new kakao.maps.services.Geocoder();
    
                // 주소 검색
                geocoder.addressSearch(postCode, function (result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
    
                        // 지도 생성 및 마커 추가
                        var map = new kakao.maps.Map(container, {
                            center: coords,
                            level: 3
                        });
    
                        var marker = new kakao.maps.Marker({
                            position: coords,
                            map: map
                        });
                    }
                });
            });
        };
    

    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
    <head>
        <%- include('../../common/head.ejs', {title: '컨퍼런스 핸들러 페이지' }) %>
    </head>
    <body>
        <h1>컨퍼런스 핸들러 페이지</h1>
        <button type="button" onclick="getConferenceRegister()">행사 등록 신청 승인 페이지</button>
        <div id="conferenceList">
            <!-- 행사 리스트를 여기에 동적으로 추가 -->
        </div>

        <button type="button" onclick="getrejectedConference()">거절한 행사 리스트</button>
        <div id="rejectedConferenceList">
            <!-- 거절한 행사 리스트를 여기에 동적으로 추가 -->
        </div>
    </body>
    <script>
        // 등록 신청한 행사 보기
        function getConferenceRegister() {
            axios({
                method: 'GET',
                url: '/manager/getConferenceRegister',
            }).then((res) => {
                if (res.status === 200) {
                    const conferenceList = res.data.conferences;
                    console.log("conferenceList >>>>", conferenceList);
                    if (Array.isArray(conferenceList) && conferenceList.length > 0) {
                        const conferenceListContainer = document.getElementById('conferenceList');
                        conferenceListContainer.innerHTML = ''; // Clear previous content

                        conferenceList.forEach((conference) => {
                            const conferenceElement = document.createElement('div');
                            // 행사를 직접적으로 보이게 하는 부분
                            conferenceElement.innerHTML = `
                                <p>행사 이름: ${conference.con_title}</p>
                                <p>행사 시작날짜: ${conference.con_start_date}</p>
                                <button onclick="approveConference(${conference.con_id})">등록 승인</button>
                                <button onclick="rejectConference(${conference.con_id})">승인 거절</button>
                            `;
                            // conference.{DB변수명}으로 접근할 수 있습니다. 등록 신청한 행사가 예쁘게 보여졌으면 좋을 것같아요!
                            conferenceListContainer.appendChild(conferenceElement);
                        });
                    } else {
                        const conferenceListContainer = document.getElementById('conferenceList');
                        conferenceListContainer.innerHTML = '신청한 새로운 행사가 없습니다.';
                    }
                }
            });
        }
        // 컨퍼런스 승인하기
        function approveConference(conferenceId) {
            axios({
                method: 'POST',
                url:'/manager/approveConference',
                data : {
                    conferenceId: conferenceId,
                }
            }).then ((res) =>{
                if (res.status === 200) {
                    console.log(res);
                    alert ('승인 완료되었습니다!');
                } else {
                    alert ('error');
                }
            })
        };
        // 컨퍼런스 거절하기
        function rejectConference(conferenceId) {
            axios({
                method: 'POST',
                url:'/manager/rejectConference',
                data : {
                    conferenceId: conferenceId,
                }
            }).then ((res) =>{
                if (res.status === 200) {
                    console.log(res);
                    alert ('행사 승인을 거절합니다.');
                } else {
                    alert ('error');
                }
            })
        };
        // 거절한 컨퍼런스 보기
        function getrejectedConference(){
            axios({
                method: 'GET',
                url: '/manager/rejectedConferenceList',
            }).then((res) => {
                if (res.status === 200) {
                    const rejectedConferenceList = res.data.conferences;
                    if (Array.isArray(rejectedConferenceList) && rejectedConferenceList.length > 0) {
                        const rejectedConferenceListContainer = document.getElementById('rejectedConferenceList');
                        rejectedConferenceListContainer.innerHTML = ''; // Clear previous content

                        rejectedConferenceList.forEach((conference) => {
                            const rejectedElement = document.createElement('div');
                            // 행사를 직접적으로 보이게 하는 부분
                            rejectedElement.innerHTML = `
                                <p>행사 이름: ${conference.con_title}</p>
                            `;
                            // conference.{DB변수명}으로 접근할 수 있습니다. 등록 신청한 행사가 예쁘게 보여졌으면 좋을 것같아요!
                            rejectedConferenceListContainer.appendChild(rejectedElement);
                        });
                    } else {
                        const rejectedConferenceListContainer = document.getElementById('rejectedConferenceList');
                        rejectedConferenceListContainer.innerHTML = '거절한 행사가 없습니다.';
                    }
                }
            });
        };
    </script>
</html>